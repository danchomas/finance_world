<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–∏—Ä –§–∏–Ω–∞–Ω—Å–æ–≤</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* –°–∫—Ä—ã–≤–∞–µ–º scrollbar –¥–ª—è Chrome, Safari –∏ Opera */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º scrollbar –¥–ª—è IE, Edge –∏ Firefox */
        .no-scrollbar {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: none;  /* Firefox */
        }
        
        .body-no-scroll {
            overflow: hidden;
            position: fixed;
            width: 100%;
            height: 100%;
        }
        
        .modal-backdrop {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 40;
        }
        
        .modal-content {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 20px 20px 0 0;
            max-height: 90vh;
            overflow-y: auto;
            z-index: 50;
        }
        
        .modal-enter {
            animation: modalSlideUp 0.3s ease-out;
        }
        
        @keyframes modalSlideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }
        
        .product-card {
            transition: all 0.2s ease;
        }
        
        .product-card:active {
            transform: scale(0.98);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
        .select-wrapper {
            position: relative;
        }
        
        .select-wrapper select {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
        }
        
        .select-wrapper::after {
            content: "‚ñº";
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            color: #666;
            font-size: 12px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π */
        .input-field {
            transition: border-color 0.2s ease;
        }
        
        .input-field:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }
        
        /* –õ–æ–≥–æ—Ç–∏–ø - –æ–±—Ä–µ–∑–∫–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —á–∞—Å—Ç–∏ */
        .logo-container {
            position: relative;
            overflow: hidden;
            border-radius: 50%;
        }
        
        .logo-container img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            min-width: 100%;
            min-height: 100%;
            object-fit: cover;
        }
        
        /* –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤ */
        .product-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px;
        }
        
        .product-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-gradient-to-r from-blue-600 to-purple-600 text-white sticky top-0 z-30">
        <div class="px-4 py-3">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <div class="logo-container w-8 h-8 bg-white">
                        <img src="assets/logo.png" alt="–õ–æ–≥–æ—Ç–∏–ø –ú–∏—Ä –§–∏–Ω–∞–Ω—Å–æ–≤">
                    </div>
                    <h1 class="text-lg font-bold">–ú–∏—Ä –§–∏–Ω–∞–Ω—Å–æ–≤</h1>
                </div>
                <button id="adminBtn" class="p-2 bg-white/20 rounded-lg">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- Search -->
    <div class="px-4 py-3 bg-white border-b">
        <div class="relative">
            <input type="text" id="searchInput" placeholder="–ü–æ–∏—Å–∫ –ø—Ä–æ–¥—É–∫—Ç–æ–≤..."
                class="w-full px-4 py-2 pl-10 bg-gray-100 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            <svg class="absolute left-3 top-2.5 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
        </div>
    </div>

    <!-- Categories -->
    <div class="px-4 py-3 bg-white">
        <div class="flex space-x-2 overflow-x-auto no-scrollbar pb-2">
            <button class="category-btn px-4 py-2 bg-blue-100 text-blue-600 rounded-full whitespace-nowrap active:bg-blue-200" data-category="all">
                –í—Å–µ
            </button>
            <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
        </div>
    </div>

    <!-- Products List -->
    <main class="pb-20">
        <div class="px-4 py-3">
            <h2 class="text-lg font-bold mb-3">–ë–∞–Ω–∫–æ–≤—Å–∫–∏–µ –ø—Ä–æ–¥—É–∫—Ç—ã</h2>
            <div id="productsList" class="space-y-3">
                <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
            
            <div id="noProducts" class="hidden text-center py-12">
                <div class="text-gray-400 text-5xl mb-4">üîç</div>
                <h3 class="text-lg font-semibold text-gray-600 mb-2">–ü—Ä–æ–¥—É–∫—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                <p class="text-gray-500">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞</p>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 z-20">
        <div class="flex justify-around items-center h-14">
            <button class="flex flex-col items-center justify-center w-full h-full active:bg-gray-100">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                </svg>
                <span class="text-xs mt-1 text-blue-600">–ì–ª–∞–≤–Ω–∞—è</span>
            </button>
            
            <button id="menuBtn" class="flex flex-col items-center justify-center w-full h-full active:bg-gray-100">
                <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
                </svg>
                <span class="text-xs mt-1 text-gray-600">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
            </button>
        </div>
    </nav>

    <!-- Categories Modal -->
    <div id="categoriesModal" class="modal-backdrop hidden">
        <div class="modal-content modal-enter">
            <div class="p-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</h3>
                    <button onclick="closeModal('categoriesModal')" class="p-2 text-gray-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-4" id="categoriesList">
                <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- Product Details Modal -->
    <div id="productModal" class="modal-backdrop hidden">
        <div class="modal-content modal-enter">
            <div class="p-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold" id="productModalTitle"></h3>
                    <button onclick="closeModal('productModal')" class="p-2 text-gray-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-4 max-h-[calc(90vh-120px)] overflow-y-auto" id="productModalContent">
                <!-- –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
            </div>
        </div>
    </div>

    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="modal-backdrop hidden">
        <div class="modal-content modal-enter">
            <div class="p-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold">–í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É</h3>
                    <button onclick="closeModal('adminLoginModal')" class="p-2 text-gray-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-4">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="adminPassword" 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field"
                               placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∞">
                    </div>
                    <button id="loginBtn" 
                            class="w-full bg-blue-600 text-white py-3 rounded-lg font-medium active:bg-blue-700">
                        –í–æ–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Panel Modal -->
    <div id="adminPanelModal" class="modal-backdrop hidden">
        <div class="modal-content modal-enter" style="max-height: 90vh;">
            <div class="p-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold">–ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</h3>
                    <button onclick="closeModal('adminPanelModal')" class="p-2 text-gray-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-4 max-h-[calc(90vh-120px)] overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <button id="addProductBtn" 
                            class="bg-green-600 text-white px-4 py-2 rounded-lg active:bg-green-700">
                        –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
                    </button>
                    <div class="text-sm text-gray-600">
                        <span id="productCount">0</span> –ø—Ä–æ–¥—É–∫—Ç–æ–≤
                    </div>
                </div>
                
                <div class="space-y-3" id="adminProductsList">
                    <!-- –ü—Ä–æ–¥—É–∫—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω–∞ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
                </div>
            </div>
        </div>
    </div>

    <!-- Product Form Modal -->
    <div id="productFormModal" class="modal-backdrop hidden">
        <div class="modal-content modal-enter" style="max-height: 90vh;">
            <div class="p-4 border-b border-gray-200">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-bold" id="productFormTitle">–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç</h3>
                    <button onclick="closeModal('productFormModal')" class="p-2 text-gray-500">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="p-4 max-h-[calc(90vh-120px)] overflow-y-auto">
                <form id="productForm" class="space-y-4">
                    <input type="hidden" id="productId">
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
                        <input type="text" id="productName" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ë–∞–Ω–∫ *</label>
                        <input type="text" id="productBank" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ö–∞—Ç–µ–≥–æ—Ä–∏—è *</label>
                        <div class="select-wrapper">
                            <select id="productCategory" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field bg-white">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</label>
                        <input type="file" id="productImage" accept="image/*"
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field">
                        <div id="imagePreviewContainer" class="mt-2 hidden">
                            <img id="imagePreview" class="w-full h-32 object-contain rounded-lg border">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ *</label>
                        <textarea id="productDescription" rows="3" required
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–£—Å–ª–æ–≤–∏—è *</label>
                        <input type="text" id="productConditions" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">–°—Å—ã–ª–∫–∞ *</label>
                        <input type="url" id="productUrl" required
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg input-field"
                               placeholder="https://">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="productActive" class="w-4 h-4 mr-2" checked>
                        <label class="text-sm text-gray-700">–ê–∫—Ç–∏–≤–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç</label>
                    </div>
                    
                    <div class="flex space-x-3 pt-4 border-t">
                        <button type="button" id="deleteProductBtn" 
                                class="flex-1 bg-red-600 text-white py-3 rounded-lg font-medium active:bg-red-700 hidden">
                            –£–¥–∞–ª–∏—Ç—å
                        </button>
                        <button type="submit"
                                class="flex-1 bg-blue-600 text-white py-3 rounded-lg font-medium active:bg-blue-700">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:8000';
        let products = [];
        let categories = [];
        let currentCategory = 'all';
        let currentSearch = '';
        let adminToken = localStorage.getItem('adminToken');
        let isAdminLoggedIn = !!adminToken;
        let scrollPosition = 0;

        // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞
        function lockScroll() {
            scrollPosition = window.pageYOffset;
            document.body.classList.add('body-no-scroll');
            document.body.style.top = `-${scrollPosition}px`;
        }

        // –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å–∫—Ä–æ–ª–ª–∞
        function unlockScroll() {
            document.body.classList.remove('body-no-scroll');
            document.body.style.top = '';
            window.scrollTo(0, scrollPosition);
        }

        // –û—Ç–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function openModal(modalId) {
            lockScroll();
            document.getElementById(modalId).classList.remove('hidden');
        }

        // –ó–∞–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            unlockScroll();
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —ç—Å–∫–µ–π–ø–∏–Ω–≥–∞ HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        async function loadCategories() {
            try {
                const response = await fetch(`${API_BASE_URL}/categories`);
                categories = await response.json();
                renderCategoryButtons();
                renderCategorySelect();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π:', error);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        async function loadProducts() {
            try {
                const response = await fetch(`${API_BASE_URL}/products`);
                products = await response.json();
                renderProducts();
                if (isAdminLoggedIn) {
                    renderAdminProducts();
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤:', error);
            }
        }

        // –†–µ–Ω–¥–µ—Ä –∫–Ω–æ–ø–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
        function renderCategoryButtons() {
            const container = document.querySelector('.category-btn').parentNode;
            // –£–¥–∞–ª—è–µ–º –≤—Å–µ, –∫—Ä–æ–º–µ –∫–Ω–æ–ø–∫–∏ "–í—Å–µ"
            const allButton = container.querySelector('[data-category="all"]');
            container.innerHTML = '';
            container.appendChild(allButton);
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = 'category-btn px-4 py-2 bg-gray-100 rounded-full whitespace-nowrap active:bg-blue-100 active:text-blue-600';
                button.dataset.category = category.id;
                button.innerHTML = `
                    <span class="mr-2">${escapeHtml(category.icon)}</span>
                    ${escapeHtml(category.name)}
                `;
                button.addEventListener('click', () => filterByCategory(category.id));
                container.appendChild(button);
            });
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            updateActiveCategory();
        }

        // –†–µ–Ω–¥–µ—Ä —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –º–æ–¥–∞–ª–∫–∏
        function renderCategoriesList() {
            const container = document.getElementById('categoriesList');
            container.innerHTML = `
                <button onclick="filterByCategory('all'); closeModal('categoriesModal');" 
                        class="category-list-item w-full text-left px-4 py-3 rounded-lg active:bg-gray-100 mb-2 ${currentCategory === 'all' ? 'bg-blue-50 text-blue-600' : ''}">
                    <div class="flex items-center">
                        <span class="text-lg mr-3">üìã</span>
                        <span class="font-medium">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</span>
                    </div>
                </button>
            `;
            
            categories.forEach(category => {
                const button = document.createElement('button');
                button.className = `category-list-item w-full text-left px-4 py-3 rounded-lg active:bg-gray-100 mb-2 ${currentCategory === category.id ? 'bg-blue-50 text-blue-600' : ''}`;
                button.innerHTML = `
                    <div class="flex items-center">
                        <span class="text-lg mr-3">${escapeHtml(category.icon)}</span>
                        <span class="font-medium">${escapeHtml(category.name)}</span>
                    </div>
                `;
                button.addEventListener('click', () => {
                    filterByCategory(category.id);
                    closeModal('categoriesModal');
                });
                container.appendChild(button);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–π –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        function renderCategorySelect() {
            const select = document.getElementById('productCategory');
            const currentValue = select.value;
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>';
            categories.forEach(category => {
                const option = document.createElement('option');
                option.value = category.id;
                option.textContent = escapeHtml(category.name);
                if (category.id === currentValue) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function filterByCategory(categoryId) {
            currentCategory = categoryId;
            updateActiveCategory();
            renderProducts();
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        function updateActiveCategory() {
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –≤ —Ö–µ–¥–µ—Ä–µ
            document.querySelectorAll('.category-btn').forEach(btn => {
                const isActive = btn.dataset.category === currentCategory;
                btn.classList.toggle('bg-blue-100', isActive);
                btn.classList.toggle('text-blue-600', isActive);
                btn.classList.toggle('bg-gray-100', !isActive);
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –≤ –º–æ–¥–∞–ª–∫–µ
            if (document.getElementById('categoriesList')) {
                document.querySelectorAll('.category-list-item').forEach(item => {
                    const itemCategory = item.querySelector('span.font-medium').textContent;
                    const category = categories.find(c => c.name === itemCategory);
                    const isActive = category ? category.id === currentCategory : currentCategory === 'all';
                    item.classList.toggle('bg-blue-50', isActive);
                    item.classList.toggle('text-blue-600', isActive);
                });
            }
        }

        // –ü–æ–∏—Å–∫
        function performSearch() {
            currentSearch = document.getElementById('searchInput').value.trim().toLowerCase();
            renderProducts();
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤
        function renderProducts() {
            const container = document.getElementById('productsList');
            const noProducts = document.getElementById('noProducts');
            
            if (!container) return;
            
            let filteredProducts = products.filter(product => {
                const matchesCategory = currentCategory === 'all' || product.category === currentCategory;
                const matchesSearch = !currentSearch || 
                    product.name.toLowerCase().includes(currentSearch) ||
                    product.bank.toLowerCase().includes(currentSearch) ||
                    product.description.toLowerCase().includes(currentSearch);
                return matchesCategory && matchesSearch && product.active;
            });
            
            if (filteredProducts.length === 0) {
                container.innerHTML = '';
                noProducts.classList.remove('hidden');
                return;
            }
            
            noProducts.classList.add('hidden');
            container.innerHTML = '';
            
            filteredProducts.forEach(product => {
                const category = categories.find(c => c.id === product.category);
                const productCard = document.createElement('div');
                productCard.className = 'product-card bg-white rounded-xl shadow p-4';
                productCard.innerHTML = `
                    <div class="flex items-start mb-3">
                        ${product.image_url ? `
                            <div class="product-image-container w-16 h-16 bg-gray-100 flex-shrink-0 mr-3">
                                <img src="http://localhost:8000${product.image_url}" 
                                     alt="${escapeHtml(product.name)}"
                                     class="product-image"
                                     onerror="this.onerror=null; this.src='https://via.placeholder.com/64/cccccc/999999?text=Image'">
                            </div>
                        ` : `
                            <div class="w-16 h-16 bg-gray-100 rounded-lg flex-shrink-0 mr-3 flex items-center justify-center text-2xl">
                                ${category?.icon ? escapeHtml(category.icon) : 'üìã'}
                            </div>
                        `}
                        <div class="flex-1">
                            <div class="flex justify-between items-start">
                                <h3 class="font-bold text-gray-900">${escapeHtml(product.name)}</h3>
                                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full">
                                    ${category ? escapeHtml(category.name) : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                                </span>
                            </div>
                            <p class="text-purple-600 font-medium text-sm mt-1">${escapeHtml(product.bank)}</p>
                            <p class="text-gray-600 text-sm mt-2 line-clamp-2">${escapeHtml(product.description)}</p>
                        </div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 mb-3">
                        <p class="text-sm text-gray-700">${escapeHtml(product.conditions)}</p>
                    </div>
                    <button class="apply-btn w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-medium active:opacity-90">
                        –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É
                    </button>
                `;
                
                productCard.addEventListener('click', (e) => {
                    if (e.target.classList.contains('apply-btn')) {
                        window.open(product.url, '_blank');
                    } else {
                        showProductDetails(product);
                    }
                });
                
                container.appendChild(productCard);
            });
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å –¥–µ—Ç–∞–ª–∏ –ø—Ä–æ–¥—É–∫—Ç–∞
        function showProductDetails(product) {
            const category = categories.find(c => c.id === product.category);
            document.getElementById('productModalTitle').textContent = escapeHtml(product.name);
            
            document.getElementById('productModalContent').innerHTML = `
                <div class="space-y-4">
                    <div class="product-image-container bg-gray-100 rounded-lg h-48">
                        <img src="http://localhost:8000${product.image_url}" 
                             alt="${escapeHtml(product.name)}"
                             class="product-image"
                             onerror="this.onerror=null; this.src='https://via.placeholder.com/400x200/cccccc/999999?text=–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ+–ø—Ä–æ–¥—É–∫—Ç–∞'">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="bg-blue-50 rounded-lg p-3">
                            <p class="text-xs text-gray-500">–ë–∞–Ω–∫</p>
                            <p class="font-medium">${escapeHtml(product.bank)}</p>
                        </div>
                        <div class="bg-blue-50 rounded-lg p-3">
                            <p class="text-xs text-gray-500">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</p>
                            <p class="font-medium">${category ? escapeHtml(category.name) : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}</p>
                        </div>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-500 mb-1">–û–ø–∏—Å–∞–Ω–∏–µ</p>
                        <p class="text-gray-700 whitespace-pre-line">${escapeHtml(product.description)}</p>
                    </div>
                    
                    <div>
                        <p class="text-sm text-gray-500 mb-1">–£—Å–ª–æ–≤–∏—è</p>
                        <p class="text-gray-700">${escapeHtml(product.conditions)}</p>
                    </div>
                    
                    <button onclick="window.open('${product.url}', '_blank')"
                            class="w-full bg-gradient-to-r from-blue-600 to-purple-600 text-white py-3 rounded-lg font-medium mt-6 active:opacity-90">
                        –ü–æ–¥–∞—Ç—å –∑–∞—è–≤–∫—É –Ω–∞ —Å–∞–π—Ç–µ
                    </button>
                </div>
            `;
            
            openModal('productModal');
        }

        // –ê–¥–º–∏–Ω-—Ñ—É–Ω–∫—Ü–∏–∏
        async function adminLogin() {
            const password = document.getElementById('adminPassword').value;
            if (!password) {
                alert('–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å');
                return;
            }
            
            try {
                const formData = new URLSearchParams();
                formData.append('username', 'admin@finance.ru');
                formData.append('password', password);
                
                const response = await fetch(`${API_BASE_URL}/token`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: formData
                });
                
                if (response.ok) {
                    const data = await response.json();
                    adminToken = data.access_token;
                    localStorage.setItem('adminToken', adminToken);
                    isAdminLoggedIn = true;
                    closeModal('adminLoginModal');
                    openModal('adminPanelModal');
                    renderAdminProducts();
                } else {
                    alert('–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', error);
                alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
            }
        }

        // –†–µ–Ω–¥–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –¥–ª—è –∞–¥–º–∏–Ω–∞
        function renderAdminProducts() {
            const container = document.getElementById('adminProductsList');
            if (!container) return;
            
            container.innerHTML = '';
            document.getElementById('productCount').textContent = products.length;
            
            products.forEach(product => {
                const category = categories.find(c => c.id === product.category);
                const item = document.createElement('div');
                item.className = 'bg-white rounded-lg border p-3';
                item.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-1">
                            <h4 class="font-bold text-gray-900">${escapeHtml(product.name)}</h4>
                            <p class="text-sm text-gray-600">${escapeHtml(product.bank)}</p>
                            <div class="flex items-center mt-2">
                                <span class="text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded-full mr-2">
                                    ${category ? escapeHtml(category.name) : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ'}
                                </span>
                                <span class="text-xs ${product.active ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'} px-2 py-1 rounded-full">
                                    ${product.active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                </span>
                            </div>
                        </div>
                        <div class="flex flex-col space-y-1 ml-2">
                            <button onclick="editProduct('${product.id}')" 
                                    class="px-3 py-1 bg-blue-600 text-white text-xs rounded active:bg-blue-700">
                                –†–µ–¥.
                            </button>
                            <button onclick="deleteProduct('${product.id}')" 
                                    class="px-3 py-1 bg-red-600 text-white text-xs rounded active:bg-red-700">
                                –£–¥.
                            </button>
                        </div>
                    </div>
                `;
                container.appendChild(item);
            });
        }

        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç
        async function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('productFormTitle').textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–¥—É–∫—Ç';
            document.getElementById('productId').value = productId;
            document.getElementById('productName').value = product.name;
            document.getElementById('productBank').value = product.bank;
            document.getElementById('productCategory').value = product.category;
            document.getElementById('productDescription').value = product.description;
            document.getElementById('productConditions').value = product.conditions;
            document.getElementById('productUrl').value = product.url;
            document.getElementById('productActive').checked = product.active;
            
            if (product.image_url) {
                document.getElementById('imagePreview').src = `http://localhost:8000${product.image_url}`;
                document.getElementById('imagePreviewContainer').classList.remove('hidden');
            } else {
                document.getElementById('imagePreviewContainer').classList.add('hidden');
            }
            
            document.getElementById('deleteProductBtn').classList.remove('hidden');
            closeModal('adminPanelModal');
            openModal('productFormModal');
        }

        // –£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
        async function deleteProduct(productId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø—Ä–æ–¥—É–∫—Ç?')) return;
            
            try {
                if (!adminToken) {
                    alert('–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É.');
                    return;
                }
                
                const response = await fetch(`${API_BASE_URL}/products/${productId}`, {
                    method: 'DELETE',
                    headers: { 
                        'Authorization': `Bearer ${adminToken}`
                    }
                });
                
                if (response.ok) {
                    await loadProducts();
                    renderAdminProducts();
                    alert('–ü—Ä–æ–¥—É–∫—Ç —É–¥–∞–ª–µ–Ω');
                } else {
                    alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + response.statusText);
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è: ' + error.message);
            }
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç
        async function saveProduct(e) {
            e.preventDefault();
            
            if (!adminToken) {
                alert('–í—ã –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã. –í–æ–π–¥–∏—Ç–µ –≤ –∞–¥–º–∏–Ω–∫—É.');
                return;
            }
            
            const productId = document.getElementById('productId').value;
            const isEdit = !!productId;
            
            const formData = new FormData();
            formData.append('name', document.getElementById('productName').value);
            formData.append('bank', document.getElementById('productBank').value);
            formData.append('category', document.getElementById('productCategory').value);
            formData.append('description', document.getElementById('productDescription').value);
            formData.append('conditions', document.getElementById('productConditions').value);
            formData.append('url', document.getElementById('productUrl').value);
            formData.append('active', document.getElementById('productActive').checked);
            
            const imageFile = document.getElementById('productImage').files[0];
            if (imageFile) {
                formData.append('file', imageFile);
            }
            
            try {
                const url = isEdit ? 
                    `${API_BASE_URL}/products/${productId}` : 
                    `${API_BASE_URL}/products`;
                
                const response = await fetch(url, {
                    method: isEdit ? 'PUT' : 'POST',
                    headers: { 
                        'Authorization': `Bearer ${adminToken}`
                    },
                    body: formData
                });
                
                if (response.ok) {
                    await loadProducts();
                    renderAdminProducts();
                    closeModal('productFormModal');
                    alert(isEdit ? '–ü—Ä–æ–¥—É–∫—Ç –æ–±–Ω–æ–≤–ª–µ–Ω' : '–ü—Ä–æ–¥—É–∫—Ç –¥–æ–±–∞–≤–ª–µ–Ω');
                } else {
                    const errorText = await response.text();
                    alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + (response.status === 401 ? '–ù–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω' : errorText));
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message);
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', async () => {
            await loadCategories();
            await loadProducts();
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            document.getElementById('searchInput').addEventListener('input', performSearch);
            
            // –ö–Ω–æ–ø–∫–∞ –∞–¥–º–∏–Ω–∞
            document.getElementById('adminBtn').addEventListener('click', () => {
                if (isAdminLoggedIn) {
                    openModal('adminPanelModal');
                } else {
                    openModal('adminLoginModal');
                }
            });
            
            // –ú–µ–Ω—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π
            document.getElementById('menuBtn').addEventListener('click', () => {
                renderCategoriesList();
                openModal('categoriesModal');
            });
            
            // –õ–æ–≥–∏–Ω –∞–¥–º–∏–Ω–∞
            document.getElementById('loginBtn').addEventListener('click', adminLogin);
            document.getElementById('adminPassword').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') adminLogin();
            });
            
            // –§–æ—Ä–º–∞ –ø—Ä–æ–¥—É–∫—Ç–∞
            document.getElementById('productForm').addEventListener('submit', saveProduct);
            document.getElementById('addProductBtn').addEventListener('click', () => {
                document.getElementById('productFormTitle').textContent = '–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–¥—É–∫—Ç';
                document.getElementById('productForm').reset();
                document.getElementById('productActive').checked = true;
                document.getElementById('imagePreviewContainer').classList.add('hidden');
                document.getElementById('deleteProductBtn').classList.add('hidden');
                document.getElementById('productId').value = '';
                renderCategorySelect();
                closeModal('adminPanelModal');
                openModal('productFormModal');
            });
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–∞
            document.getElementById('deleteProductBtn').addEventListener('click', () => {
                const productId = document.getElementById('productId').value;
                if (productId) {
                    deleteProduct(productId);
                }
            });
            
            // –ü—Ä–µ–≤—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            document.getElementById('productImage').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('imagePreview').src = event.target.result;
                        document.getElementById('imagePreviewContainer').classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –Ω–∞ —Ñ–æ–Ω
            document.querySelectorAll('.modal-backdrop').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        closeModal(modal.id);
                    }
                });
            });
            
            // –ù–∞–∂–∞—Ç–∏–µ Escape –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–æ–∫
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    const openModals = document.querySelectorAll('.modal-backdrop:not(.hidden)');
                    if (openModals.length > 0) {
                        closeModal(openModals[openModals.length - 1].id);
                    }
                }
            });
        });

        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è onclick
        window.closeModal = closeModal;
        window.filterByCategory = filterByCategory;
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
    </script>
</body>
</html>